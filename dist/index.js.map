{
  "version": 3,
  "sources": ["../src/ui.ts", "../src/tinypix.ts"],
  "sourcesContent": ["function loadImage(url: string): Promise<HTMLImageElement> {\n\treturn new Promise<HTMLImageElement>((resolve, reject) => {\n\t\tlet img = new Image();\n\t\timg.onload = () => resolve(img);\n\t\timg.onerror = reject;\n\t\timg.src = url;\n\t});\n}\n\nclass EventMouse {\n\tconstructor (public type: \"down\" | \"moved\" | \"dragged\" | \"up\" | \"moved-global\", public x: number, public y: number) { }\n\n\ttoLocal(x: number, y: number): EventMouse {\n\t\treturn new EventMouse(this.type, this.x - x, this.y - y);\n\t}\n}\n\ntype UIEvent = EventMouse;\n\ninterface View {\n\tx: number, y: number, width: number, height: number;\n\n\tevent(event: UIEvent): boolean;\n\tlayout(): void;\n\tdraw(ctx: CanvasRenderingContext2D): void;\n}\n\nclass BaseView implements View {\n\tconstructor (public x: number, public y: number, public width: number, public height: number) {\n\t}\n\n\tinBounds(x: number, y: number): boolean {\n\t\treturn this.x <= x &&\n\t\t\tthis.y <= y &&\n\t\t\tthis.x + this.width > x &&\n\t\t\tthis.y + this.height > y;\n\t}\n\n\tevent(event: UIEvent): boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tlayout() {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n}\n\nclass BaseButton extends BaseView {\n\tconstructor (x: number, y: number, width: number, height: number, public onclick: () => void = () => { }) {\n\t\tsuper(x, y, width, height);\n\t}\n\n\tevent(event: UIEvent): boolean {\n\t\tif (event instanceof EventMouse) {\n\t\t\tif (!this.inBounds(event.x, event.y)) return false;\n\t\t\tif (event.type === \"up\" && this.onclick) {\n\t\t\t\tthis.onclick();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tlayout() { }\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t}\n}\n\nclass ColorButton extends BaseButton {\n\tactiveColor: string;\n\n\tconstructor (x: number, y: number, width: number, height: number, public color: string | { hover: string, noHover: string }, public onclick: () => void = () => { }) {\n\t\tsuper(x, y, width, height);\n\t\tif (typeof color === \"string\") this.activeColor = color;\n\t\telse this.activeColor = color.hover;\n\t}\n\n\tevent(ev: UIEvent): boolean {\n\t\tif (ev instanceof EventMouse) {\n\t\t\tif (ev.type === \"moved-global\" && typeof this.color !== \"string\") {\n\t\t\t\tconsole.log(ev);\n\t\t\t\tthis.activeColor = this.inBounds(ev.x, ev.y) ? this.color.hover : this.color.noHover;\n\t\t\t}\n\t\t}\n\t\treturn super.event(ev);\n\t}\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t\tctx.fillStyle = this.activeColor;\n\t\tctx.fillRect(this.x, this.y, this.width, this.height);\n\t}\n}\n\nclass ImageButton extends BaseButton {\n\tconstructor (x: number, y: number, public image: HTMLImageElement, public onclick: () => void = () => { }) {\n\t\tsuper(x, y, image.width, image.height);\n\t}\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t\tctx.drawImage(this.image, this.x, this.y, this.width, this.height);\n\t}\n}\n\nclass VStack extends BaseView {\n\tprivate views: Array<View> = [];\n\n\tconstructor (x: number, y: number) {\n\t\tsuper(x, y, 0, 0);\n\t}\n\n\tadd(view: View): VStack {\n\t\tthis.views.push(view);\n\t\tthis.layout();\n\t\treturn this;\n\t}\n\n\tevent(ev: UIEvent): boolean {\n\t\tif (ev instanceof EventMouse) {\n\t\t\tif (ev.type != \"moved-global\" && !this.inBounds(ev.x, ev.y)) return false;\n\t\t\tev = ev.toLocal(this.x, this.y);\n\t\t}\n\t\tfor (var view of this.views) {\n\t\t\tif (view.event(ev)) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlayout() {\n\t\t// layout sub-views and calculate\n\t\t// max width.\n\t\tlet maxWidth = 0;\n\t\tfor (var view of this.views) {\n\t\t\tview.layout();\n\t\t\tmaxWidth = Math.max(maxWidth, view.width);\n\t\t}\n\t\tthis.width = maxWidth;\n\n\t\t// position sub-views\n\t\tlet lastY = 0;\n\t\tthis.height = 0;\n\t\tfor (var view of this.views) {\n\t\t\tview.x = 0;\n\t\t\tview.y = lastY;\n\t\t\tlastY += view.height;\n\t\t\tthis.height += view.height;\n\t\t}\n\t}\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t\tctx.save();\n\t\tctx.translate(this.x, this.y);\n\t\tfor (var view of this.views)\n\t\t\tview.draw(ctx);\n\t\tctx.restore();\n\t}\n}\n\nclass HStack extends BaseView {\n\tprivate views: Array<View> = [];\n\n\tconstructor (x: number, y: number) {\n\t\tsuper(x, y, 0, 0);\n\t}\n\n\tadd(view: View): HStack {\n\t\tthis.views.push(view);\n\t\tthis.layout();\n\t\treturn this;\n\t}\n\n\tevent(ev: UIEvent): boolean {\n\t\tif (ev instanceof EventMouse) {\n\t\t\tif (ev.type != \"moved-global\" && !this.inBounds(ev.x, ev.y)) return false;\n\t\t\tev = ev.toLocal(this.x, this.y);\n\t\t}\n\t\tfor (var view of this.views) {\n\t\t\tif (view.event(ev)) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlayout() {\n\t\t// layout sub-views and calculate\n\t\t// max height.\n\t\tlet maxHeight = 0;\n\t\tfor (var view of this.views) {\n\t\t\tview.layout();\n\t\t\tmaxHeight = Math.max(maxHeight, view.width);\n\t\t}\n\t\tthis.height = maxHeight;\n\n\t\t// position sub-views\n\t\tlet lastX = 0;\n\t\tthis.width = 0;\n\t\tfor (var view of this.views) {\n\t\t\tview.x = lastX;\n\t\t\tview.y = 0;\n\t\t\tlastX += view.width;\n\t\t\tthis.width += view.width;\n\t\t}\n\t}\n\n\tdraw(ctx: CanvasRenderingContext2D) {\n\t\tctx.save();\n\t\tctx.translate(this.x, this.y);\n\t\tfor (var view of this.views)\n\t\t\tview.draw(ctx);\n\t\tctx.restore();\n\t}\n}\n\nexport class UI {\n\treadonly ctx: CanvasRenderingContext2D;\n\tviews: Array<View> = [];\n\n\tconstructor (readonly canvas: HTMLCanvasElement) {\n\t\tthis.ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n\t\tthis.ctx.imageSmoothingEnabled = false;\n\t\tlet foo = loadImage(\"/sprite.png\");\n\t\tPromise.all([foo]).then((values) => {\n\t\t\tthis.setupInput(canvas);\n\n\t\t\tconsole.log(\"Loaded all assets\");\n\t\t\tlet views = this.views;\n\n\t\t\tlet tools = new VStack(0, 48);\n\t\t\ttools.add(new ColorButton(0, 0, 48, 48, { hover: \"red\", noHover: \"green\" }, () => alert(\"Clicked red.\")));\n\t\t\tlet img = new ImageButton(0, 0, values[0] as HTMLImageElement, () => alert(\"Clicked image.\"))\n\t\t\timg.width = img.width * 4;\n\t\t\timg.height = img.height * 4;\n\t\t\ttools.add(img);\n\t\t\tviews.push(tools);\n\n\t\t\tlet menu = new HStack(48, 0);\n\t\t\tmenu.add(new ColorButton(0, 0, 64, 64, \"blue\", () => alert(\"Clicked blue.\")));\n\t\t\tmenu.add(new ColorButton(0, 0, 48, 48, \"yellow\", () => alert(\"Clicked yellow.\")));\n\t\t\tviews.push(menu);\n\n\t\t\trequestAnimationFrame(() => this.draw());\n\t\t});\n\t}\n\n\tsetupInput(canvas: HTMLCanvasElement) {\n\t\tlet coords = (ev: MouseEvent) => {\n\t\t\tlet rect = canvas.getBoundingClientRect();\n\t\t\tlet x = ev.clientX - rect.left;\n\t\t\tlet y = ev.clientY - rect.top;\n\t\t\treturn { x: x, y: y };\n\t\t}\n\n\t\tlet broadcastEvent = (ev: UIEvent) => {\n\t\t\tconsole.log(ev);\n\t\t\tfor (var view of this.views) {\n\t\t\t\tif (view.event(ev)) break;\n\t\t\t}\n\t\t}\n\n\t\tvar buttonDown = false;\n\n\t\tcanvas.addEventListener(\"mousedown\", (ev) => {\n\t\t\tlet { x, y } = coords(ev);\n\t\t\tbuttonDown = true;\n\t\t\tbroadcastEvent(new EventMouse(\"down\", x, y));\n\t\t}, true);\n\n\t\tcanvas.addEventListener(\"mousemove\", (ev) => {\n\t\t\tlet { x, y } = coords(ev);\n\t\t\tbroadcastEvent(new EventMouse(buttonDown ? \"dragged\" : \"moved\", x, y));\n\t\t\tbroadcastEvent(new EventMouse(\"moved-global\", x, y));\n\t\t}, true);\n\n\t\tcanvas.addEventListener(\"mouseup\", (ev) => {\n\t\t\tlet { x, y } = coords(ev);\n\t\t\tbuttonDown = false;\n\t\t\tbroadcastEvent(new EventMouse(\"up\", x, y));\n\t\t}, true);\n\t}\n\n\tdraw() {\n\t\trequestAnimationFrame(() => this.draw());\n\n\t\tlet canvas = this.canvas;\n\t\tvar dpr = window.devicePixelRatio || 1;\n\t\tvar w = Math.round(canvas.clientWidth * dpr);\n\t\tvar h = Math.round(canvas.clientHeight * dpr);\n\t\tif (canvas.width != w || canvas.height != h) {\n\t\t\tcanvas.width = w;\n\t\t\tcanvas.height = h;\n\t\t}\n\n\t\tlet ctx = this.ctx;\n\t\tctx.save();\n\t\tctx.scale(dpr, dpr);\n\t\tthis.ctx.imageSmoothingEnabled = false;\n\t\tctx.fillStyle = \"gray\";\n\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\n\t\tfor (var view of this.views) {\n\t\t\tview.draw(ctx);\n\t\t}\n\t\tctx.restore();\n\t}\n}", "import { UI } from \"./ui\";\n\nlet canvas = document.getElementById(\"screen\") as HTMLCanvasElement;\nnew UI(canvas);"],
  "mappings": "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",
  "names": []
}
